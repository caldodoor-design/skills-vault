---
name: verifying-before-completion
description: 作業完了・修正済み・テスト通過を主張する前に、検証コマンドの実行と出力確認を必須とするプロセス。証拠なき完了報告を防止する。
trigger: 作業完了の報告、修正済みの主張、コミットやPR作成の直前、次のタスクへの移行時
---

# 完了前の検証

## 概要

検証なしに作業完了を主張することは、効率ではなく不誠実である。

**基本原則:** 証拠が先、主張は後。常に。

**このルールの形式的な違反は、ルールの本質への違反である。**

## 鉄則

```
新鮮な検証証拠なしに完了を主張してはならない
```

このメッセージ内で検証コマンドを実行していなければ、通過したと主張してはならない。

## ゲート関数

```
ステータスの主張や満足の表明の前に必ず実行:

1. 特定: この主張を証明するコマンドは何か？
2. 実行: 完全なコマンドを実行（新規、完全に）
3. 読解: 全出力を読み、終了コードを確認、失敗数をカウント
4. 検証: 出力が主張を裏付けているか？
   - いいえ → 証拠付きで実際のステータスを報告
   - はい → 証拠付きで主張を報告
5. その後で初めて: 主張を行う

いずれかのステップを省略 = 検証ではなく虚偽
```

## よくある失敗パターン

| 主張 | 必要な証拠 | 不十分なもの |
|------|-----------|-------------|
| テスト通過 | テストコマンド出力: 0件の失敗 | 前回の実行結果、「通るはず」 |
| Linterクリーン | Linter出力: 0件のエラー | 部分的チェック、推測 |
| ビルド成功 | ビルドコマンド: exit 0 | Linter通過、ログが良さそう |
| バグ修正済み | 元の症状のテスト: 通過 | コード変更済み、修正されたと推測 |
| 回帰テスト動作 | Red-Greenサイクル検証済み | テストが一度通過 |
| エージェント完了 | VCS差分で変更を確認 | エージェントの「成功」報告 |
| 要件充足 | 行ごとのチェックリスト | テスト通過のみ |

## 危険信号 - 停止せよ

以下に該当したら停止:
- 「はず」「おそらく」「らしい」を使っている
- 検証前に満足を表明（「完了！」「完璧！」など）
- 検証なしにコミット/プッシュ/PR作成しようとしている
- エージェントの成功報告を鵜呑みにしている
- 部分的な検証に依存している
- 「今回だけは」と思っている
- 疲れて早く終わらせたいと思っている
- **検証を実行せずに成功を示唆するいかなる文言も**

## 言い訳への対処

| 言い訳 | 現実 |
|--------|------|
| 「もう動くはず」 | 検証を実行せよ |
| 「自信がある」 | 自信 ≠ 証拠 |
| 「今回だけは」 | 例外なし |
| 「Linterが通った」 | Linter ≠ コンパイラ |
| 「エージェントが成功と言った」 | 独立して検証せよ |
| 「疲れた」 | 疲労 ≠ 免除 |
| 「部分チェックで十分」 | 部分的証明は何も証明しない |
| 「言い方が違うからルール適用外」 | 形式より本質 |

## 主要パターン

**テスト:**
```
正: [テストコマンド実行] [結果: 34/34通過] 「全テスト通過」
誤: 「もう通るはず」 / 「正しく見える」
```

**回帰テスト（TDD Red-Green）:**
```
正: テスト作成 → 実行（通過）→ 修正を取り消し → 実行（必ず失敗）→ 修正復元 → 実行（通過）
誤: 「回帰テストを書きました」（Red-Green検証なし）
```

**ビルド:**
```
正: [ビルド実行] [結果: exit 0] 「ビルド通過」
誤: 「Linterが通った」（Linterはコンパイルをチェックしない）
```

**要件:**
```
正: 計画を再読 → チェックリスト作成 → 各項目を検証 → ギャップまたは完了を報告
誤: 「テスト通過、フェーズ完了」
```

**エージェント委譲:**
```
正: エージェントが成功を報告 → VCS差分を確認 → 変更を検証 → 実際の状態を報告
誤: エージェントの報告を信頼
```

## なぜこれが重要か

過去の失敗から:
- 「信じられない」とユーザーに言われた - 信頼の喪失
- 未定義の関数がそのまま出荷された - クラッシュの原因
- 要件不足のまま出荷された - 不完全な機能
- 虚偽の完了報告 → 方向転換 → やり直しで時間浪費

## 適用タイミング

**以下の前に必ず実施:**
- 成功/完了に関するあらゆる主張
- 満足の表明
- 作業状態に関するあらゆる肯定的な発言
- コミット、PR作成、タスク完了
- 次のタスクへの移行
- エージェントへの委譲

## 結論

**検証に近道はない。**

コマンドを実行せよ。出力を読め。その後で結果を主張せよ。

これは交渉の余地がない。

## 元リポジトリ

→ https://github.com/obra/superpowers (skills/verification-before-completion/)
