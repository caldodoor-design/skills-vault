---
name: polling-adaptively
description: バックグラウンドコマンドの適応型ポーリング戦略。トークン節約とレスポンス品質の両立。
trigger: バックグラウンド処理の結果待ちが必要な時
---

# 適応型ポーリング (Adaptive Polling) スキル

バックグラウンドで実行中のコマンドを効率的に監視し、APIトークンの消費を最小限に抑えるための手順。

## 概要

`run_command` でバックグラウンド実行したタスクの完了を待機する際、固定の短い間隔（10秒等）で `command_status` を繰り返すと、トークン消費が激しくなります。
これを防ぐため、待機時間を段階的に延長する「適応型ポーリング」を採用します。

## 手順

1. **実行**: コマンドをバックグラウンドで開始する。
2. **待機（1回目）**: `command_status` を `WaitDurationSeconds: 30` で呼び出す。
3. **判定**: ステータスが `DONE` なら完了。 `RUNNING` なら次へ。
4. **待機（2回目）**: `command_status` を `WaitDurationSeconds: 60` で呼び出す。
5. **待機（3回目以降）**: 以降、完了するまで `WaitDurationSeconds: 120` で繰り返す。

## メリット

- 短いタスク（ビルド等）は30秒程度で検知可能。
- 長いタスク（コードレビュー等）において、不要なAPI呼び出しを大幅に削減できる。
- コンテキスト・ウィンドウの節約。
